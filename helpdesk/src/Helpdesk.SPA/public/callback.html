<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Моля, изчакайте...</title>
</head>
<body>
    <script src="js/oidc-client.min.js"></script>
    <script>

        var mgr = new Oidc.UserManager({ response_mode: 'query', userStore: new Oidc.WebStorageStateStore() }).signinRedirectCallback()
        .then(function (user) {
          console.log("signin response success", user.state);
           if (user.state){
             window.history.replaceState({}, window.document.title, window.location.origin + window.location.pathname);
             window.location = user.state.redirect || "/";
           }
          else
          {
            let href = window.location.href;
            let dir = href.substring(0, href.lastIndexOf('/')) + "/";
            window.location.href = dir;
          }
        }).catch(function (err) {
          console.log(err);
          // Todo: да се помисли за съобщение и редирект при грешка
        });

    </script>
</body>
</html>
