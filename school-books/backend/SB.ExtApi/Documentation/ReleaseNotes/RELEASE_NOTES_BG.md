# Release Notes

[comment]: # (!!! Не забравяй да промениш и document.Version в services.AddOpenApiDocument !!!)

[comment]: # (## v1.0.23)
[comment]: # (- промяна 1)
[comment]: # (- промяна 2)

## v1.0.22
- Добавен е индикатор (`MedicalNoticeBatchDO.HasMore`) дали има още медицински бележки за извличане за текущия доставчик в API-то за извличане на медицински бележки `MedicalNotices`. В редки случаи могат да бъдат получени по-малко бележки от поисканите с параметъра next, но всъщност да има още за извличане. Затова е желателно да се провери това поле и ако е `true` да се извика отново метода MedicalNotices_GetNext.

## v1.0.21
- Добавено е API за извличане на медицински бележки от Националната здравно информационна система (НЗИС) - `MedicalNotices`
- Премахване на валидацията за полето `GradeResult.InitialResultType`, вече може да се създава или променя запис с `RepeatsGrade` стойност.

## v1.0.20
- Промяна на StatusCode-овете връшани при грешки от базата, както следва
    - Timeout - 408 RequestTimeout
    - ViolationOfCheckConstraint - 400 BadRequest
    - ViolationOfReferenceConstraint - 400 BadRequest
    - ViolationOfUniqueKeyConstraint - 409 Conflict
    - ViolationOfUniqueIndex - 409 Conflict

## v1.0.19
- Полето `GradeDO.CurriculumId` вече не е задължително, когато е подадено `ScheduleLessonId`.

## v1.0.18
- Добавени са API-та за функционалноста "Приключване"
    - `ClassBookDO.IsFinalized` - Флаг за приключен дневник
    - `/{schoolYear}/{institutionId}/classBooks/{classBookId}/finalize` - endpoint за приключване, който приема само PDF файлове подписани с КЕП.
    - `/{schoolYear}/{institutionId}/classBooks/{classBookId}/unfinalize` - endpoint за премахване на приключване
- Добавена е възможност да се качват дробни годишни оценки по премети с начин на изучаване:
    - 152 - ПП (I профилиращ предмет)
    - 153 - ПП (II профилиращ предмет)
    - 154 - ПП (III профилиращ предмет)
    - 155 - ПП (IV профилиращ предмет)
    - 156 - ПП (III/IV профилиращ предмет)
- Добавено е поле `PgResultDO.SubjectId` и UNIQUE CONSTRAINT в PgResult `(SchoolYear, ClassBookId, PersonId, SubjectId)`. Полето `PgResultDO.CurriculumId` е `deprecated`, като от него се взима `Curriculum.SubjectId` ако такова не бъде попълнено в `PgResultDO`

## v1.0.17
- Добавено е поле `SysErrorMessage` в грешките със `StatusCode = 400`, което съдържа грешки от базата данни отговарящи на някои от следните регулярни изрази. За тези грешки системата връща `StatusCode = 400` вместо `StatusCode = 500`.

    - `The timeout period elapsed prior to completion of the operation or the server is not responding`
    - `The (INSERT|UPDATE) statement conflicted with the CHECK constraint \"CHK_[a-zA-Z_0-9]+\"`
    - `The (UPDATE|DELETE) statement conflicted with the REFERENCE constraint \"FK_[a-zA-Z_0-9]+\"`
    - `Violation of UNIQUE KEY constraint 'UK_[a-zA-Z_0-9]+'`
    - `Cannot insert duplicate key row in object '[a-zA-Z_0-9.]+' with unique index '(UQ|IX)_[a-zA-Z_0-9]+'`

## v1.0.16
- Добавена е възможност да се подава Term за оценките, които нямат ScheduleLessonId - `GradeDO.Term`.

## v1.0.15
- Добавена е възможност за Резултати в ПГ по образователно направление - `PgResultDO.CurriculumId`. Оставена е опцията да се подават резултати без образователно направление (`CurriculumId = NULL`). Има индекс за уникалност на наредената n-торка `(SchoolYear, ClassBookId, PersonId, CurriculumId)`.

## v1.0.14
- Добавена е възможност за множество теми в един час - `TopicDO.Titles`, полето `Title` е оставено за backwards compatibility

## v1.0.13
- Добавено е API за "Пренесени отсъствия" - `StudentCarriedAbsences`
- Добавена е възможност настройките на учебната година да са за конкретни паралелки/групи - `SchoolYearDateInfoDO.ClassBookIds`
- Добавена е възможност за създаване на дневници за паралелки/групи без "Вид на паралелката" (`ClassType`)

## v1.0.12
- Добавена е валидация за дължината на всички полета от тип "string" (maxLength атрибута в swagger)

## v1.0.11
- Добавен e тип на оценката 98 - "От друг клас"
- **BREAKING CHANGE!** Оценки от тип 98 - "От друг клас" и 99 - "От друго училище" вече са **без** `ScheduleLessonId` по подобие на 21 - "Срочна" и 22 - "Годишна"

## v1.0.10
- Добавена е възможност неучебните периоди да са за конкретни паралелки/групи - `OffDayDO.ClassBookIds`
- Добавена е възможност данни в дневниците да се подават и за отписани ученици

## v1.0.9
- Добавена е възможност за промяна на смяната на съществуващо разписание със съвместима такава, т.е. която обхваща всички използвани часове (в отсъствие, оценка, тема).
- Добавена е възможност за създаване на разписания със собствени смени (Adhoc shifts).
- Добавена е възможност за създаване на разписания включващи събота и неделя.
- Добавено е API за "Дейности по интереси" - `StudentActivities`
- Добавено е API за "Номер на ученика" - `StudentClassNumbers`
- Добавено е API за "Освободен по предмети" - `StudentGradelessCurriculums`
- Добавено е API за "СОП оценки по предмети" - `StudentSpecialNeedCurriculums`

## v1.0.8
- Добавено е API за "Учителски отсъствия" - `TeacherAbsences`
- Добавено е API за "Допълнителни дейности" за дневник 3-5 (ДГ/ПГ) - `AdditionalActivities`
- Премахнато е полето за идентификатор на предмет от учебния план (`CurriculumId`) от обекта за отсъствие (`Absence`), тъй като се припокриваше със същото поле в занятието, с което е свързано отсъствието (`ScheduleLesson`).

## v1.0.7
- Добавена е възможност за отделяне на седмици от седмично разписание (`Schedule`) в ново разписание. За разлика от редакцията на разписание, отделянето на седмици може да се направи и при наличие на свързани обекти (Оценки/Отсъствия/Теми) за занятията от разписанието. Идентификаторите на отделените занятия (ScheduleLessonId) не се променят след операцията, като всички свързани обекти (Оценки/Отсъствия/Теми) остават коректно свързани с отделеното разписание.

## v1.0.6
- Добавена е възможност за създаване на седмични разписания (`Schedule`) с по-малко часове от часовете на смяната
- Добавена е възможност за създаване на смени (`Shift`) с начало > край (Напр. 18:00 -> 01:00)
- Добавена е възможност за създаване на смени (`Shift`) с непоследователни часове - 1, 3, 5.
- **BREAKING CHANGE!** В смени (`Shift`) има ново изискване часът да е по-голям или равен на 0 (`hourNumber >= 0`).
  Това изискване винаги е важало при създаване на разписания (`Schedule`) и опити за създаване на разписания с такива часове са връщали грешка.
- Добавена е възможност за създаване на смени (`Shift`) с различни режими за различните дни от седмицата.
  За тази цел в `ShiftDO` е добавено поле `isMultiday`, което указва, че смяната е с различни режими за различните дни.
  Също така в `ShiftHourDO` е добавено поле `day`, което указва кой час за кой ден се отнася. Ако смяната е без различни режими (`isMultiday = false`), то `day` трябва да е винаги 1.
  Временно е оставена възможност `isMultiday` и `day` да не са задължителни, в които случаи се счита, че `isMultiday=false` и `day=1`.

## v1.0.5
- Добавено е API за "Подкрепа" за дневници 3-14(1-3кл), 3-16(4кл), 3-87(5-12кл) и 3-62(ЦСОП) - `Supports`
- Добавено е API за "Индивидуална работа" за дневници 3-16(4кл) и 3-62(ЦСОП) - `IndividualWorks`
- Добавено е API за "Изяви" за дневник 3-63.1(ДПЛР) - `Performances`
- Добавено е API за "Участие в РЕПЛР" за дневник 3-63.1(ДПЛР) - `ReplrParticipations`

## v1.0.4
- **BREAKING CHANGE!** Бележките вече могат да се създават за николко/няколко/всички ученици.
  За целта са добавени две нови пропъртита `IsForAllStudents` и `Students`, както и са премахнати `ClassId` и `PersonId`

## v1.0.3
- Добавено е API за "Настройки на учебната година" - `SchoolYearDateInfo`

## v1.0.2
- Полето `TopicDO.curriculumId` става незадължително и **deprecated** и ще бъде премахнато в някоя от следващите версии

## v1.0.1
- Полето `ScheduleDO.term` става незадължително
