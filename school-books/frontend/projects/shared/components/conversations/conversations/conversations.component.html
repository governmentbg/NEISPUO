<sb-banner *ngIf="!hasConversations">
  Нямате съобщения до този момент. Може да създадете ново съобщение
  <a [routerLink]="['./', 'new']" class="text-primary underline">тук</a>
  .
</sb-banner>

<div *ngIf="hasConversations" class="h-[calc(100vh-160px)] flex flex-col overflow-hidden">
  <div class="flex flex-col md:flex-row flex-1">
    <div class="w-full md:w-1/3 md:pr-4 flex flex-col">
      <div>
        <a [routerLink]="['./', 'new']" class="mb-4" mat-raised-button color="primary" aria-label="Ново съобщение">
          <fa-icon [icon]="fasPlus" size="lg"></fa-icon>
          <span>Ново съобщение</span>
        </a>
      </div>
      <sb-card-section>Съобщения</sb-card-section>
      <div class="flex-1 flex flex-col">
        <div class="hidden md:block flex-1 overflow-hidden">
          <cdk-virtual-scroll-viewport
            class="list-container h-full overflow-y-auto p-2"
            [itemSize]="50"
            (scrolledIndexChange)="onScrolledIndexChange($event)"
          >
            <button
              *cdkVirtualFor="let item of conversationsData$ | async"
              class="shadow-md bg-gray-100 hover:bg-gray-300 transition p-2 w-full text-left my-1 rounded-md"
              (click)="navigateToConversation(item.conversationId)"
            >
              <div
                [ngClass]="{
                  'text-gray-800': selectedConversation !== item.conversationId,
                  'font-bold text-blue-700': selectedConversation === item.conversationId
                }"
                class="text-gray-800 pb-2 truncate"
              >
                {{ item.title }}
              </div>
              <div class="flex justify-between ju text-sm text-gray-400 pt-2">
                <span>{{ item.lastMessageDate | timeAgo }}</span>
                <fa-icon
                  *ngIf="item.hasNewMessages"
                  size="lg"
                  [icon]="fasEnvelop"
                  matTooltip="ново съобщение"
                ></fa-icon>
              </div>
            </button>
          </cdk-virtual-scroll-viewport>
        </div>

        <mat-form-field appearance="fill" class="block md:hidden w-full">
          <mat-select
            #matSelect
            [value]="selectedConversation"
            (selectionChange)="onDropdownSelect($event)"
            (scroll)="onDropdownScroll($event)"
          >
            <mat-option *ngFor="let item of conversationsData$ | async" [value]="item.conversationId">
              <div class="flex items-center truncate">
                <span class="truncate">{{ item.title }}</span>
              </div>
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="w-full md:w-2/3 md:pl-4 md:border-l flex-1 overflow-hidden">
      <router-outlet></router-outlet>
    </div>
  </div>
</div>
