<sb-tab-card>
  <ng-container card-title>Електронни медицински бележки</ng-container>
  <ng-container card-buttons class="flex-row-reverse">
    <a mat-raised-button [routerLink]="['../']">
      <fa-icon [icon]="fasArrowLeft" size="lg"></fa-icon>
      <span class="hidden sm:inline">Назад</span>
    </a>
  </ng-container>
  <ng-container card-body>
    <div [formGroup]="searchForm" novalidate class="sm:grid grid-cols-2 gap-x-4">
      <sb-nom-select
        class="col-span-full"
        label="Ученик"
        formControlName="studentPersonId"
        [nomService]="classBookStudentNomsService"
      ></sb-nom-select>

      <sb-date-field label="От дата" formControlName="fromDate"></sb-date-field>
      <sb-date-field label="До дата" formControlName="toDate"></sb-date-field>
    </div>

    <sb-table [dataSource]="dataSource" [displayedColumns]="['student', 'period', 'nrnMedicalNotice', 'pmi']">
      <ng-container cdkColumnDef="student">
        <th cdk-header-cell *cdkHeaderCellDef>Ученик</th>
        <td cdk-cell *cdkCellDef="let row">
          {{ row.studentFullName }}
          <span *ngIf="row.badge" class="sb-badge text-sm">{{ row.badge }}</span>
        </td>
      </ng-container>

      <ng-container cdkColumnDef="period">
        <th cdk-header-cell *cdkHeaderCellDef>Обхваща Дата/Период</th>
        <td cdk-cell *cdkCellDef="let row">
          <ng-container *ngIf="row.fromDate.getTime() === row.toDate.getTime(); else period">
            <span>{{ row.fromDate | sbDate }}</span>
          </ng-container>

          <ng-template #period>
            <span>{{ row.fromDate | sbDate }} - {{ row.toDate | sbDate }}</span>
          </ng-template>
        </td>
      </ng-container>

      <ng-container cdkColumnDef="nrnMedicalNotice">
        <th cdk-header-cell *cdkHeaderCellDef>НРН</th>
        <td cdk-cell *cdkCellDef="let row">{{ row.nrnMedicalNotice }}/{{ row.authoredOn | sbDate }}</td>
      </ng-container>

      <ng-container cdkColumnDef="pmi">
        <th cdk-header-cell *cdkHeaderCellDef>УИН на лекаря</th>
        <td cdk-cell *cdkCellDef="let row">{{ row.pmi }}</td>
      </ng-container>

      <ng-container no-data-row>
        <td colspan="4" class="text-center">
          {{
            searchForm.value.studentPersonId || searchForm.value.fromDate || searchForm.value.toDate
              ? 'Няма намерени електронни медицински бележки за въведените критерии за търсене'
              : 'Няма подадени електронни медицински бележки за учениците в ' + fullBookName
          }}
        </td>
      </ng-container>
    </sb-table>
  </ng-container>
</sb-tab-card>
