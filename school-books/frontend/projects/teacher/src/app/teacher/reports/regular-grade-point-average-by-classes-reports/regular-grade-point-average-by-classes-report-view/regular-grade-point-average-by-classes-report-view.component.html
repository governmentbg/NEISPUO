<sb-breadcrumb
  class="block mb-3"
  [icon]="fadCalendarMinus"
  [text]="
    data.regularGradePointAverageByClassesReport == null
      ? 'Създаване на справка среден успех от текущи оценки по класове'
      : 'Преглед на справка среден успех от текущи оценки по класове'
  "
  [parentItems]="[{ text: 'Среден успех от текущи оценки по класове', routeCommands: ['../'] }]"
></sb-breadcrumb>

<form [formGroup]="form" autocomplete="off" novalidate>
  <sb-card>
    <ng-container card-title>
      {{
        data.regularGradePointAverageByClassesReport == null
          ? 'Създаване на справка среден успех от текущи оценки по класове'
          : 'Преглед на справка среден успех от текущи оценки по класове'
      }}
    </ng-container>
    <sb-editor-panel
      card-buttons
      [isNew]="data.regularGradePointAverageByClassesReport == null"
      [editBtnHidden]="true"
      (save)="onSave($event)"
    >
      <a
        *ngIf="data.regularGradePointAverageByClassesReport != null"
        [href]="downloadUrl"
        class="mr-3"
        disabled-mode-buttons
        target="_blank"
        download
        color="primary"
        mat-raised-button
        [disabled]="!downloadUrl"
      >
        <fa-icon [icon]="fasFileExcel" size="lg"></fa-icon>
        <span>Свали</span>
      </a>
      <button
        disabled-mode-buttons
        mat-raised-button
        color="warn"
        type="button"
        (click)="onRemove()"
        [disabled]="removing"
      >
        <fa-icon [icon]="removing ? fasSpinnerThird : fasTrashAlt" [spin]="removing" size="lg"></fa-icon>
        <span class="hidden sm:inline">Премахни</span>
      </button>
    </sb-editor-panel>
    <ng-container card-body>
      <div class="sm:grid grid-cols-4 gap-x-4 mb-2">
        <sb-nom-select
          class="col-start-1"
          [nomService]="reportPeriodNomsService"
          label="Период"
          formControlName="period"
        ></sb-nom-select>
        <sb-nom-select
          *ngIf="data.regularGradePointAverageByClassesReport == null"
          label="Паралелки/Групи"
          formControlName="classBookIds"
          [multiple]="true"
          [nomService]="classBookNomsService"
        ></sb-nom-select>
        <sb-text-field
          *ngIf="data.regularGradePointAverageByClassesReport != null"
          label="Паралелки/Групи"
          formControlName="classBookNames"
        ></sb-text-field>
      </div>
      <sb-card-section *ngIf="data.regularGradePointAverageByClassesReport != null" class="col-span-full">
        {{ reportName }}
      </sb-card-section>
      <ng-container *ngIf="data.regularGradePointAverageByClassesReport != null && dataSource != null">
        <sb-table
          [dataSource]="dataSource"
          [displayedColumns]="[
            'classBookName',
            'curriculumInfo',
            'studentsCount',
            'studentsWithGradesCount',
            'studentsWithGradesPercentage',
            'gradePointAverage',
            'totalGradesCount',
            'poorGradesCount',
            'fairGradesCount',
            'goodGradesCount',
            'veryGoodGradesCount',
            'excellentGradesCount'
          ]"
        >
          <ng-container cdkColumnDef="classBookName">
            <th cdk-header-cell *cdkHeaderCellDef>Клас</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">{{ row.classBookName }}</td>
          </ng-container>

          <ng-container cdkColumnDef="curriculumInfo">
            <th cdk-header-cell *cdkHeaderCellDef>Предмет</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">{{ row.curriculumInfo }}</td>
          </ng-container>

          <ng-container cdkColumnDef="studentsCount">
            <th cdk-header-cell *cdkHeaderCellDef>Ученици</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">{{ row.studentsCount }}</td>
          </ng-container>

          <ng-container cdkColumnDef="studentsWithGradesCount">
            <th cdk-header-cell *cdkHeaderCellDef>Изпитани ученици</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">
              {{ row.studentsWithGradesCount === 0 ? '-' : row.studentsWithGradesCount }}
            </td>
          </ng-container>

          <ng-container cdkColumnDef="studentsWithGradesPercentage">
            <th cdk-header-cell *cdkHeaderCellDef>% изпитани</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">
              {{ row.studentsWithGradesPercentage === 0 ? '-' : row.studentsWithGradesPercentage }}
            </td>
          </ng-container>

          <ng-container cdkColumnDef="gradePointAverage">
            <th cdk-header-cell *cdkHeaderCellDef>Успех</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">
              {{ row.gradePointAverage === 0 ? '-' : row.gradePointAverage }}
            </td>
          </ng-container>

          <ng-container cdkColumnDef="totalGradesCount">
            <th cdk-header-cell *cdkHeaderCellDef>Оценки</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">{{ row.totalGradesCount }}</td>
          </ng-container>

          <ng-container cdkColumnDef="poorGradesCount">
            <th cdk-header-cell *cdkHeaderCellDef>Слаб 2</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">{{ row.poorGradesCount }}</td>
          </ng-container>

          <ng-container cdkColumnDef="fairGradesCount">
            <th cdk-header-cell *cdkHeaderCellDef>Среден 3</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">{{ row.fairGradesCount }}</td>
          </ng-container>

          <ng-container cdkColumnDef="goodGradesCount">
            <th cdk-header-cell *cdkHeaderCellDef>Добър 4</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">{{ row.goodGradesCount }}</td>
          </ng-container>

          <ng-container cdkColumnDef="veryGoodGradesCount">
            <th cdk-header-cell *cdkHeaderCellDef>Мн. Добър 5</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">{{ row.veryGoodGradesCount }}</td>
          </ng-container>

          <ng-container cdkColumnDef="excellentGradesCount">
            <th cdk-header-cell *cdkHeaderCellDef>Отличен 6</th>
            <td cdk-cell [class.font-bold]="row.isTotal" *cdkCellDef="let row">{{ row.excellentGradesCount }}</td>
          </ng-container>

          <ng-container no-data-row>
            <td colspan="12" class="text-center">Няма класове с оценки за периода</td>
          </ng-container>
        </sb-table>
      </ng-container>
    </ng-container>
  </sb-card>
</form>
