<sb-breadcrumb
  class="block mb-3"
  [icon]="
    mode === TeacherAbsencesMode.All
      ? fadCalendarMinus
      : mode === TeacherAbsencesMode.My
      ? fadUserMinus
      : mode === TeacherAbsencesMode.MyRepl
      ? fadUserPlus
      : undefined
  "
  [text]="
    mode === TeacherAbsencesMode.All
      ? 'Всички отсъствия'
      : mode === TeacherAbsencesMode.My
      ? 'Мои отсъствия'
      : mode === TeacherAbsencesMode.MyRepl
      ? 'Мои замествания'
      : ''
  "
></sb-breadcrumb>

<sb-card>
  <ng-container card-title>
    {{
      mode === TeacherAbsencesMode.All
        ? 'Всички отсъствия'
        : mode === TeacherAbsencesMode.My
        ? 'Мои отсъствия'
        : mode === TeacherAbsencesMode.MyRepl
        ? 'Мои замествания'
        : ''
    }}
  </ng-container>
  <ng-container *ngIf="canCreate" card-buttons>
    <a [routerLink]="['./', 'new']" mat-raised-button color="primary" aria-label="Ново отсъствие">
      <fa-icon [icon]="fasPlus" size="lg"></fa-icon>
      <span>Ново отсъствие</span>
    </a>
  </ng-container>
  <ng-container card-body>
    <div class="sm:grid grid-cols-2 gap-x-4 mb-2" [formGroup]="searchForm" novalidate>
      <sb-text-field
        *ngIf="mode === TeacherAbsencesMode.All || mode === TeacherAbsencesMode.MyRepl"
        [class.col-span-full]="mode === TeacherAbsencesMode.MyRepl"
        label="Учител"
        formControlName="teacherName"
      ></sb-text-field>
      <sb-text-field
        *ngIf="mode === TeacherAbsencesMode.All || mode === TeacherAbsencesMode.My"
        [class.col-span-full]="mode === TeacherAbsencesMode.My"
        label="Заместващ"
        formControlName="replTeacherName"
      ></sb-text-field>
    </div>

    <sb-table
      [dataSource]="dataSource"
      [displayedColumns]="['action', 'startDate', 'endDate', 'teacherName', 'replTeacherNames', 'reason']"
    >
      <ng-container cdkColumnDef="action">
        <th cdk-header-cell *cdkHeaderCellDef></th>
        <td cdk-cell *cdkCellDef="let row" class="sb-table-action">
          <a [routerLink]="['./', row.teacherAbsenceId]" aria-label="Редактирай" class="sb-link-btn">
            <fa-icon [icon]="fadChevronCircleRight"></fa-icon>
          </a>
        </td>
      </ng-container>

      <ng-container cdkColumnDef="startDate">
        <th cdk-header-cell *cdkHeaderCellDef>Начална дата</th>
        <td cdk-cell *cdkCellDef="let row">{{ row.startDate | sbDate }}</td>
      </ng-container>

      <ng-container cdkColumnDef="endDate">
        <th cdk-header-cell *cdkHeaderCellDef>Крайна дата</th>
        <td cdk-cell *cdkCellDef="let row">{{ row.endDate | sbDate }}</td>
      </ng-container>

      <ng-container cdkColumnDef="teacherName">
        <th cdk-header-cell *cdkHeaderCellDef>Отсъстващ</th>
        <td cdk-cell *cdkCellDef="let row">{{ row.teacherName }}</td>
      </ng-container>

      <ng-container cdkColumnDef="replTeacherNames">
        <th cdk-header-cell *cdkHeaderCellDef>Заместващ</th>
        <td cdk-cell *cdkCellDef="let row">
          {{
            row.replTeacherNames.length < 3
              ? row.replTeacherNames.join(', ')
              : row.replTeacherNames.slice(0, 2).join(', ') + '\u2026'
          }}
        </td>
      </ng-container>

      <ng-container cdkColumnDef="reason">
        <th cdk-header-cell *cdkHeaderCellDef>Причина</th>
        <td cdk-cell *cdkCellDef="let row">{{ row.reason }}</td>
      </ng-container>

      <ng-container *ngIf="searchForm.value.teacherName || searchForm.value.replTeacherName" no-data-row>
        <td colspan="7" class="text-center">Няма намерени отсъствия</td>
      </ng-container>
    </sb-table>
  </ng-container>
</sb-card>
